<table>
  <col width="33%">
  <col width="67%">
  <tr>
    <td>
      <span class="heading1">
        Configure task<br/>
      </span>
      <span class="heading1" style="font-size: 18pt">
        <br/>
          Client: <%= link_to @task.job.client.name, client_path(@task.job.client) %><br/>
          Job: <%= link_to @task.job.name , edit_job_path(@task.job) %><br/>
        <%= form_for @task do |f| %>
            Task name <%= f.text_field :name , :class=>"input" , :style => "width: 200px;" %>  <%= f.submit "OK", :class=>"small_button" %><br/>
        <% end %>
      </span>

        <div class="select_box_wrapper" style="height: 140px; margin-top: 10px; background-color: lightpink">
          <span class="heading2">Fee-earners for this task</span>
          <br/>
          <div class="select_box_list" style="height: 100px">
            <%= form_tag task_remove_user_path(@task),  :id => 'remove_users' do %>
              <% if @task.myusers%>

                <% @task.myusers.each do |myuser| %>
                  <span style="white-space: nowrap;">
                    <%=check_box_tag 'check'+myuser.id.to_s %>
                    <%= link_to myuser.first_name + " " + myuser.last_name + " " + myuser.id.to_s, myuser_path(myuser) %>
                  </span>
                <% end %>

              <% end %>
            <% end %>
          </div>
          <div style="align-items: right">
            <input type="submit" value="Remove fee-earners" form='remove_users' class="small_button" style="margin-top: 4px">
            <button class="small_button" onclick="window.open('<%= tasks_message_forum_path(@task)%>', 'MsgWindow', 'width=400,height=500,left=400,top=100,location=0,status=0,titlebar=0,toolbar=0,menu=0');" >Message forum</bu
              tton>
          </div>
        </div>

      <%= form_tag task_add_user_path(@task),  :id => 'add_users' do %>
        <div class="select_box_wrapper" style="height: 140px; background-color: lightpink">
          <span class="heading2">Other fee-earners for this job</span>
          <br/>
          <div class="select_box_list" style="height: 100px">
            <% if @task.job.myusers%>

              <% @task.job.myusers.each do |myuser| %>
                <% if @task.myusers.where(:id => myuser.id).count == 0 %>
                  <span style="white-space: nowrap;">
                    <%=check_box_tag 'check'+myuser.id.to_s %>
                    <%= link_to myuser.first_name + " " + myuser.last_name + " " + myuser.id.to_s, myuser_path(myuser) %>
                  </span>
                <% end %>
              <% end %>

            <% end %>
          </div>
          <div style="align-items: right">
            <input type="submit" value="Add fee-earners" form='add_users' class="small_button" style="margin-top: 4px">
          </div>
        </div>
      <% end %>

    </td>
  <td>
    <div class="select_box_wrapper" style="height: 140px; background-color: lightblue">
      <table>
        <col width="30%"/>
        <col width="35%"/>
        <col width="35%"/>
        <tr>
          <td>
            <span class="heading2">Timetabling</span>
          </td>
          <td style="color: red">
            Estimated start:
            <% if !@task.date_error %>
              <%= @task.start_date_timestg %>
            <% else %> %>
              #DATE ERROR#
            <% end %>
          </td>
          <td style="color: red">
            Estimated end:
            <% if !@task.date_error %>
              <%= @task.end_date_timestg %>
            <% else %> %>
              #DATE ERROR#
            <% end %>
          </td>
        </tr>
      </table>

      <%= form_tag task_linked_path(@task), :id => 'linked' do %>
        Link<%= check_box_tag :linked, 1, @task.linked_flag,  onclick: "this.parentNode.submit();"  %>
      <% end %>

      <%= form_tag task_timing_path(@task), :id => 'timing_form' do %>
        <% if @task.linked_flag %>
         Link to:
              <%= select_tag "linked_to_task", options_for_select(@tasks_to_link_to, @task.linked_to_task_id) , {:style => "width:250px;"} %>

          Start<%= raw( radio_button_tag :start_end, 1, @task.link_to_start) %>
          End<%= raw( radio_button_tag :start_end, 0, !@task.link_to_start) %>

          Offset
          <span style="position: relative; top: 0; left: 0; margin-left: 20px" >
            <% if @task.bespoke_offset_flag %>
              <%= text_field_tag "offset_bespoke_period", @task.offset.to_i ,{:style => "width:44px;  text-align: right; position: absolute; top: -2px; left: -2px; background: lightblue;"} %>
            <% end %>
            <%= select_tag "offset_period_select", options_for_select(@offset_options , offset_period_value(@task) ) , {:style => "width:64px;  text-align-last:right;", :onchange => raw("timing_form.submit()")}%>
          </span>
          <% if !@task.job.daily_flag %>
            <%= select_tag "offset_days_hours", options_for_select(["Hours", "Days"], @task.offset_in_days ? "Days" : "Hours"), {:style => "width:60px; margin-left: 10px; text-align-last:left;", :onchange => raw("timing_form.submit()")} %>
          <% else %>
          days
          <% end %>


        <% else %>
          <span> Specify start date<% if !@task.job.daily_flag %> and time<% end %></span>

          <% if @task.job.daily_flag %>
            <%= date_select :start_date, "" ,
                            {
                                :order => [:day, :month, :year],
                                :default => @task.start_date} ,
                                {:class => "input" } %>
            <% else %>
            <%= datetime_select :start_date, "" ,
                                {
                                :order => [:day, :month, :year],
                                :default => @task.start_date} ,
                                {:class => "input" }  %>

            <% end %>
        <% end %>
        <br/>
        <br/>

        Specify duration
        <%= radio_button_tag :duration, 0 , !@task.fixed_end_date,  onclick: "this.parentNode.submit();" %>

        <% if !@task.fixed_end_date %>
          <span style="position: relative; top: 0; left: 0;" >
              <% if @task.bespoke_duration_flag %>
              <%= text_field_tag "duration_bespoke_period", @task.duration.to_i ,{:style => "width:42px;  text-align: right; position: absolute; top: -2px; left: 2px; background: white;"}  %>
              <% end %>
            <%= select_tag "duration_period_select", options_for_select(@duration_options, duration_period_value(@task)) , {:class =>"input" , :style => "width:64px;  text-align-last:right;", :onchange => raw("timing_form.submit()")}%>
            </span>

          <% if !@task.job.daily_flag %>
          <%= select_tag "duration_days_hours", options_for_select(["Hours", "Days"], @task.duration_in_days ? "Days" : "Hours"), {:style => "width:60px; margin-left: 10px; text-align-last:left;", :onchange => raw("timing_form.submit()")} %>
          <% else %>
          days
          <% end %>
        <% end %>

        <span style="margin-left: 30px"> Specify end date<% if !@task.job.daily_flag %> and time<% end %></span>
        <%= radio_button_tag :duration, 1, @task.fixed_end_date, onclick: "this.parentNode.submit();" %>
          <% if @task.fixed_end_date%>
            <% if @task.job.daily_flag %>

            <%= date_select :end_date, "" ,
                           {
                                :order => [:day, :month, :year],
                                :default => @task.end_date
                              },
                              {:class => "input" }  %>

            <% else %>

            <%= datetime_select :end_date, "" ,
                                {
                                :order => [:day, :month, :year],
                                :default => @task.end_date
                               },
                               {:class => "input" }  %>
            <% end %>
          <% end %>
          <br/>
        <div style="margin-top: 6px">
          <%= submit_tag "OK",  :class=>"small_button" %>
        </div>

      <% end %>


    </div>

    <div class="select_box_wrapper" style="height: 70px; background-color: lightblue; margin-top: 4px">
      <%= form_tag task_update_progress_path(@task),  :id => 'form_progress' do %>
      <table>
        <col width="10%">
        <col width="35%">
        <col width="35%">
        <col width="15%">
        <tr>
          <td><span class="heading2">Progress</span></td>
          <td>
            Comments
            <%= text_area_tag :comments, "", style: "width:97%; height: 40px" %></textarea>
          </td>
          <td>
            <table>
              <col width="40%">
              <col width="20%">
              <col width="40%">
              <tr>
                <td>
                  Time elapsed:
                </td>
                <td>
                  <div class="input" style = "width: 43px;  margin-left: 10px; margin-right: 10px; margin-top: 0px; text-align-last: right; background: #d0d0d0">
                  <%= number_to_percentage(@task.est_progress * 100, precision: 0) %>
                  </div>
                </td>
                <td>
                  complete
                </td>
              </tr>
              <tr>
                <td>
                  Work done:
                </td>
                <td>
                  <%= select_tag "progress", options_for_select(@progress, @task.percentage_completed.to_i), {:class=>"input" , :style => "width: 50px;  margin-left: 10px; margin-right: 10px; margin-top: 0px;  text-align-last: right;", :onchange  => "form_progress.submit()"} %>
                  <% end %>
                </td>
                <td>
                  % complete
                </td>
              </tr>
            </table>
            <td>
              <%= button_to "List all updates", list_updates_for_task_path(@task), :method =>'get', :class=>"small_button" %>
            </td>
          </tr>
        </table>
    </div>





    <div class="select_box_wrapper" style="height: 170px; background-color: lightblue; margin-top: 4px">
            <%= form_tag tasks_import_schedule_path(@task) do %>
            <table>
              <col width="50%"/>
              <col width="50%"/>
              <tr>
                <td>
                  <span class="heading2">Reminders</span>
                </td>
                <td style="align-items: right">
                   <%= select_tag "schedule", options_for_select(@schedules, "") , {include_blank: 'Choose bespoke schedule' , :class=> "input", :style => "width:190px;"} %>
                   <%= submit_tag "OK", class: "small_button" %>
                <% end %>

                </td>
              </tr>

            </table>

            <%= form_tag task_reminders_completed_path(@task),  :id => 'reminders' do %>
              <div class="select_box_list" style="height: 114px">
                <table>

                <% @task.update_reminders.each do |reminder| %>

                  <col width="60%">
                  <col width="20%">
                  <col width="20%">
                  <tr>
                    <td>
                      <%= link_to reminder.reminder_text, edit_update_reminder_path(reminder) , :method => :get  %> <%= reminder.id.to_s %> <%= reminder.start_datestg %> - <%= reminder.end_datestg %>

                    </td>
                    <td>
                      <%=check_box_tag 'updated' + reminder.id.to_s , 1, reminder.updated_flag, :onchange => raw("reminders.submit()")%>
                      <span style="font-size: xx-small; position: relative; top: -4px">DONE</span>
                    </td>
                    <td>
                      <%= link_to "Delete", delete_reminder_from_task_path(reminder) , :method => :get  %>
                    </td>

                  </tr>
                  </span>
                  <% end %>
              <% end %>
              </table>
            </div>

            <%= button_to "Add new reminder", update_reminder_new_for_task_path(@task), :method => "get",  :class=>"small_button" %>
          </td>
        </tr></table>
    </div>

  </td>



  </tr>
</table>
