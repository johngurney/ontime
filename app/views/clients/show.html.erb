<%= stylesheet_link_tag 'myusers', media: 'all' %>


<div style="  border-color: #606060; border-style: solid; border-width: 2px;">

  <table style="height: 68vh;" width="100%">
    <col width="66%">
    <col width="33%">
    <tr>
      <td style="vertical-align: top;">
        <h1><%= @client.name%></h1>

        <div class="select_box_wrapper" style="margin-top: 4px; background-color: yellow; ">
          Jobs
          <div class="select_box_list">
            <% if @contacts %>
              <table width="100%">
                <col width="60%">
                <col width="40%">

                <% @jobs.each do |job| %>
                  <tr>
                    <td>
                      <%= link_to job.name , edit_job_path(job) %>
                    </td>
                    <td><%= link_to 'Delete', client_delete_job_path(job), data: { confirm: 'Are you sure you wish to delete ' + job.name + '?' } %></td>

                  </tr>
                <% end %>
              </table>
            <% end %>
          </div>
          <%= button_to "Add job" , new_job_for_client_path(@client) , :method => :get %>
        </div>



      </td>
      <td >



        <%= form_tag client_users_path(@client),  :id => 'remove_supervisers' do %>
          <div class="select_box_wrapper" style="height: 100px">
            Fee-earner supervisers for this client
            <br/>
            <div class="select_box_list" style="height: 63px">
              <% if @clientmyusers%>

                <table width="100%">
                  <col width="45%">
                  <col width="15%">
                  <col width="20%">
                  <col width="20%">

                  <% Superviser.where('client_id=?', @client.id).uniq.each do |superviser| %>
                    <% myuser=Myuser.find(superviser.myuser_id) %>
                    <tr>
                      <td>
                        <%=check_box_tag 'check'+myuser.id.to_s %>
                        <%= link_to myuser.first_name + " " + myuser.last_name, myuser_path(myuser) %>
                      </td>
                      <td><%= myuser.team %></td>
                      <td><%= myuser.office %></td>
                      <td><%= myuser.position %></td>
                    </tr>
                  <% end %>

                </table>
              <% end %>
            </div>
            <input type="submit" name="function" value="Remove superviser(s)" form='remove_supervisers' style="margin-top: 4px">
          </div>

        <% end %>



        <%= form_tag client_users_path(@client),  :id => 'client_users' do %>
          <div class="select_box_wrapper" style="height: 140px; margin-top: 2px">
            Fee-earners associated with this client
            <br/>
            <div class="select_box_list" style="height: 103px;">
              <% if @clientmyusers%>

                <table width="100%">
                  <col width="45%">
                  <col width="15%">
                  <col width="20%">
                  <col width="20%">

                  <% @client.myusers.uniq.each do |myuser| %>
                    <% if Superviser.where('client_id =? AND myuser_id=?', @client.id, myuser.id).count==0 %>
                     <tr>
                        <td>
                          <%=check_box_tag 'check'+myuser.id.to_s %>
                          <%= link_to myuser.first_name + " " + myuser.last_name, myuser_path(myuser) %>
                          <%= myuser.id.to_s  %>
                        </td>
                        <td><%= myuser.team %></td>
                        <td><%= myuser.office %></td>
                        <td><%= myuser.position %></td>
                      </tr>
                    <% end %>
                  <% end %>

                </table>
              <% end %>
            </div>
            <input type="submit" name="function" value="Remove user(s)" form='client_users' style="margin-top: 4px" />
            <input type="submit" name="function" value="Add as superviser(s)" form='client_users' style="margin-top: 4px;" />

            <% if !@show_all_fes_flag %>
              <input type="submit" name="function" value="Show other user(s)" form='client_users' style="background-color: lightpink; margin-top: 4px; margin-left: 14px"/>
            <% end %>

          </div>

        <% end %>

        <% if @show_all_fes_flag %>

          <%= form_tag client_users_path(@client),  :id => 'add_users' do %>
            <div class="select_box_wrapper" style=" margin-top: 4px">
              Other fee-earners
              <div class="select_box_list">
                <% if @myusers%>
                  <table width="100%">
                    <col width="45%">
                    <col width="15%">
                    <col width="20%">
                    <col width="20%">

                    <% @myusers.each do |myuser| %>
                    <% if @clientmyusers.where(:id => myuser.id).count == 0 %>
                      <tr>
                        <td>
                          <%=check_box_tag 'check'+myuser.id.to_s %>
                          <%= link_to myuser.first_name + " " + myuser.last_name, myuser_path(myuser) %>
                        </td>
                        <td><%= myuser.team %></td>
                        <td><%= myuser.office %></td>
                        <td><%= myuser.position %></td>
                      </tr>
                    <% end %>
                  <% end %>
                  </table>
                <% end %>
              </div>
              <input type="submit" name="function" value="Add user(s)" form='add_users' style="margin-top: 4px">
              <input type="submit" name="function" value="Hide other user(s)" form='add_users' style="background-color: lightpink; margin-top: 4px; margin-left: 14px">


            </div>
          <% end %>


        <% else %>


          <div class="select_box_wrapper" style="margin-top: 2px">
            Client contacts
            <div class="select_box_list">
              <% if @contacts %>
                <table width="100%">
                  <col width="60%">
                  <col width="40%">

                  <% @contacts.each do |contact| %>
                    <tr>
                      <td>
                        <%= link_to contact.first_name + " " + contact.last_name , contact_path(contact) %>
                      </td>
                      <td><%= mail_to contact.email%></td>
                    </tr>
                  <% end %>
                </table>
              <% end %>
            </div>
            <%= button_to "Add contacts" , new_contact_for_client_path(@client) , :method => :get %>
          </div>




        <% end %>


      </td>
    </tr>
  </table>
  <table width="100%">
    <col width="20%">
    <col width="20%">
    <col width="20%">
    <col width="20%">
    <col width="20%">
    <tr>
      <td style="text-align: center">
        <%= link_to "Edit", edit_client_path(@client) %>
      </td>
      <td style="text-align: center">
        <%= link_to('Allocate users', jobs_path(@client)) %>
      </td>
      <td style="text-align: center">
        <%= link_to "Delete client", client_path(@client) , method: :delete, data: {confirm: "Are you sure?"}%>
      </td>
      <td style="text-align: center">
        <%= link_to('Clients home page', clients_path) %>
      </td>
      <td style="text-align: center">
        <%= link_to('Show jobs', jobs_path(@client)) %>
      </td>
    </tr>

  </table>

</div>






